KISSY.add('kg/dd/2.0.0/index',["./lib/ddm","./lib/draggable","./lib/draggable-delegate","./lib/droppable-delegate","./lib/droppable"],function(S ,require, exports, module) {var e=require("./lib/ddm"),r=require("./lib/draggable"),l=require("./lib/draggable-delegate"),a=require("./lib/droppable-delegate"),b=require("./lib/droppable"),g={Draggable:r,DDM:e,Droppable:b,DroppableDelegate:a,DraggableDelegate:l};KISSY.DD=g,module.exports=g;});KISSY.add('kg/dd/2.0.0/lib/ddm',["node","base"],function(S ,require, exports, module) {function e(e){var o,r,i,n=this;return e.touches&&e.touches.length>1?void A._end():((r=n.__activeToDrag)?r._move(e):(i=n.get("activeDrag"))&&(i._move(e),n.__needDropCheck&&t(n,e,i)),o=r||i,void(o&&o.get("preventDefaultOnMove")&&e.preventDefault()))}function t(e,t,o){var r,i=e.get("validDrops"),n=o.get("mode"),a=0,c=0,s=d(o.get("node")),l=u(s);S.each(i,function(e){if(e.get("disabled"))return void 0;var r,i=e.getNodeFromTarget(t,o.get("dragNode")[0],o.get("node")[0]);if(!i)return void 0;if("point"===n)h(i,o.mousePos)&&(r=u(d(i)),a?c>r&&(a=e,c=r):(a=e,c=r));else if("intersect"===n)r=u(g(s,d(i))),r>c&&(c=r,a=e);else if("strict"===n&&(r=u(g(s,d(i))),r===l))return a=e,!1;return void 0}),r=e.get("activeDrop"),r&&r!==a&&(r._handleOut(t),o._handleOut(t)),e.setInternal("activeDrop",a),a&&(r!==a?a._handleEnter(t):a._handleOver(t))}function o(e){var t=e.get("activeDrag").get("activeHandler"),o="auto";t&&(o=t.css("cursor")),"auto"===o&&(o=e.get("dragCursor")),e._shim.css({cursor:o,display:"block"}),T&&R.call(e)}function r(e){b.on(M,e._end,e),b.on(W,w,e),m.body.setCapture&&m.body.setCapture()}function i(e){b.detach(W,w,e),b.detach(M,e._end,e),m.body.releaseCapture&&m.body.releaseCapture()}function n(e){var t=e.get("drops");e.setInternal("validDrops",[]),t.length&&S.each(t,function(e){e._active()})}function a(e){var t=e.get("drops");e.setInternal("validDrops",[]),t.length&&S.each(t,function(e){e._deActive()})}function d(e){var t=e.offset();return e.__ddCachedWidth||(_.debug("no cache in dd!"),_.debug(e[0])),{left:t.left,right:t.left+(e.__ddCachedWidth||e.outerWidth()),top:t.top,bottom:t.top+(e.__ddCachedHeight||e.outerHeight())}}function c(e,t){return e.left<=t.left&&e.right>=t.left&&e.top<=t.top&&e.bottom>=t.top}function u(e){return e.top>=e.bottom||e.left>=e.right?0:(e.right-e.left)*(e.bottom-e.top)}function g(e,t){var o=Math.max(e.top,t.top),r=Math.min(e.right,t.right),i=Math.min(e.bottom,t.bottom),n=Math.max(e.left,t.left);return{left:n,right:r,top:o,bottom:i}}function h(e,t){return c(d(e),t)}function s(e){e&&(e.__ddCachedWidth=e.outerWidth(),e.__ddCachedHeight=e.outerHeight())}var l=require("node"),v=require("base"),_=S.getLogger("./ddm"),p=S.UA,f=l.all,D=S.Env.host,m=D.document,b=f(m),C=f(D),T=6===p.ie,x=3,y=1,k=30,I=999999,H=l.Gesture,W=H.move,M=H.end,O=v.extend({__activeToDrag:0,_regDrop:function(e){this.get("drops").push(e)},_unRegDrop:function(e){var t=this,o=t.get("drops"),r=S.indexOf(e,o);-1!==r&&o.splice(r,1)},_regToDrag:function(e){var t=this;t.__activeToDrag=e,r(t)},_start:function(){var e=this,t=e.__activeToDrag;t&&(e.setInternal("activeDrag",t),e.__activeToDrag=0,t.get("shim")&&E(e),e.__needDropCheck=0,t.get("groups")&&(n(e),e.get("validDrops").length&&(s(t.get("node")),e.__needDropCheck=1)))},_addValidDrop:function(e){this.get("validDrops").push(e)},_end:function(e){var t=this,o=t.__activeToDrag,r=t.get("activeDrag"),n=t.get("activeDrop");e&&(o&&o._move(e),r&&r._move(e)),i(t),o&&(o._end(e),t.__activeToDrag=0),t._shim&&t._shim.hide(),r&&(r._end(e),a(t),n&&n._end(e),t.setInternal("activeDrag",null),t.setInternal("activeDrop",null))}},{ATTRS:{dragCursor:{value:"move"},clickPixelThresh:{value:x},bufferTime:{value:y},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),w=p.ie?S.throttle(e,k):e,E=function(e){e._shim=f('<div style="background-color:red;position:'+(T?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+A.get("dragCursor")+";z-index:"+I+';"></div>').prependTo(m.body||m.documentElement).css("opacity",0),E=o,T&&C.on("resize scroll",R,e),o(e)},R=S.throttle(function(){var e,t=this;(e=t.get("activeDrag"))&&e.get("shim")&&t._shim.css({width:b.width(),height:b.height()})},k),A=new O;A.inRegion=c,A.region=d,A.area=u,A.cacheWH=s,A.PREFIX_CLS="ks-dd-",module.exports=A;});KISSY.add('kg/dd/2.0.0/lib/draggable',["node","./ddm","base"],function(S ,require, exports, module) {function e(){h.body.onselectstart=n}function t(){n=h.body.onselectstart,h.body.onselectstart=a}function r(e){e.preventDefault()}function a(){return!1}var n,o=require("node"),i=require("./ddm"),s=require("base"),d=S.UA,g=o.all,l=S.each,u=S.Features,f=d.ie,c=null,v=i.PREFIX_CLS,h=S.Env.host.document,p=s.extend({initializer:function(){var e=this;e.addTarget(i),e._allowMove=e.get("move")},_onSetNode:function(e){var t=this;t.setInternal("dragNode",e),t.bindDragEvent()},bindDragEvent:function(){var e=this,t=e.get("node");t.on(o.Gesture.start,_,e).on("dragstart",e._fixDragStart)},detachDragEvent:function(e){e=this;var t=e.get("node");t.detach(o.Gesture.start,_,e).detach("dragstart",e._fixDragStart)},_bufferTimer:c,_onSetDisabledChange:function(e){this.get("dragNode")[e?"addClass":"removeClass"](v+"-disabled")},_fixDragStart:r,_checkHandler:function(e){var t=this,r=t.get("handlers"),a=0;return l(r,function(r){return r[0]===e||r.contains(e)?(a=1,t.setInternal("activeHandler",r),!1):void 0}),a},_checkDragStartValid:function(e){var t=this;return t.get("primaryButtonOnly")&&1!==e.which||t.get("disabled")?0:1},_prepare:function(e){if(e){var r=this;f&&t(),r.get("halt")&&e.stopPropagation(),u.isTouchEventSupported()||e.preventDefault();var a=e.pageX,n=e.pageY;if(r.setInternal("startMousePos",r.mousePos={left:a,top:n}),r._allowMove){var o=r.get("node"),s=o.offset();r.setInternal("startNodePos",s),r.setInternal("deltaPos",{left:a-s.left,top:n-s.top})}i._regToDrag(r);var d=r.get("bufferTime");d&&(r._bufferTimer=setTimeout(function(){r._start(e)},1e3*d))}},_clearBufferTimer:function(){var e=this;e._bufferTimer&&(clearTimeout(e._bufferTimer),e._bufferTimer=0)},_move:function(e){var t=this,r=e.pageX,a=e.pageY;if(!t.get("dragging")){var n=t.get("startMousePos"),o=0,i=t.get("clickPixelThresh");if((Math.abs(r-n.left)>=i||Math.abs(a-n.top)>=i)&&(t._start(e),o=1),!o)return}t.mousePos={left:r,top:a};var s={drag:t,left:r,top:a,pageX:r,pageY:a,domEvent:e},d=t._allowMove;if(d){var g=t.get("deltaPos"),l=r-g.left,u=a-g.top;s.left=l,s.top=u,t.setInternal("actualPos",{left:l,top:u}),t.fire("dragalign",s)}var f=1;t.fire("drag",s)===!1&&(f=0),f&&d&&t.get("node").offset(t.get("actualPos"))},stopDrag:function(){i._end()},_end:function(t){t=t||{};var r,a=this;a._clearBufferTimer(),f&&e(),a.get("dragging")&&(a.get("node").removeClass(v+"drag-over"),(r=i.get("activeDrop"))?a.fire("dragdrophit",{drag:a,drop:r}):a.fire("dragdropmiss",{drag:a}),a.setInternal("dragging",0),a.fire("dragend",{drag:a,pageX:t.pageX,pageY:t.pageY}))},_handleOut:function(){var e=this;e.get("node").removeClass(v+"drag-over"),e.fire("dragexit",{drag:e,drop:i.get("activeDrop")})},_handleEnter:function(e){var t=this;t.get("node").addClass(v+"drag-over"),t.fire("dragenter",e)},_handleOver:function(e){this.fire("dragover",e)},_start:function(e){var t=this;t._clearBufferTimer(),t.setInternal("dragging",1),t.setInternal("dragStartMousePos",{left:e.pageX,top:e.pageY}),i._start(),t.fire("dragstart",{drag:t,pageX:e.pageX,pageY:e.pageY})},destructor:function(){var e=this;e.detachDragEvent(),e.detach()}},{name:"Draggable",ATTRS:{node:{setter:function(e){return e instanceof o?void 0:g(e)}},clickPixelThresh:{valueFn:function(){return i.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return i.get("bufferTime")}},dragNode:{},shim:{value:!1},handlers:{value:[],getter:function(e){var t=this;return e.length||(e[0]=t.get("node")),l(e,function(r,a){"function"==typeof r&&(r=r.call(t)),"string"==typeof r&&(r=t.get("node").one(r)),r.nodeType&&(r=g(r)),e[a]=r}),t.setInternal("handlers",e),e}},activeHandler:{},dragging:{value:!1,setter:function(e){var t=this;t.get("dragNode")[e?"addClass":"removeClass"](v+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{},preventDefaultOnMove:{value:!0}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}}),_=function(e){var t=this,r=e.target;if(t._checkDragStartValid(e)){if(!t._checkHandler(r))return;t._prepare(e)}};module.exports=p;});KISSY.add('kg/dd/2.0.0/lib/draggable-delegate',["node","./ddm","./draggable"],function(S ,require, exports, module) {var e=require("node"),t=require("./ddm"),r=require("./draggable"),n=t.PREFIX_CLS,a=e.all,i=function(e){var t,r,n=this;if(n._checkDragStartValid(e)){var i=n.get("handlers"),o=a(e.target);t=i.length?n._getHandler(o):o,t&&(r=n._getNode(t)),r&&(n.setInternal("activeHandler",t),n.setInternal("node",r),n.setInternal("dragNode",r),n._prepare(e))}};module.exports=r.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(e){this.get("container")[e?"addClass":"removeClass"](n+"-disabled")},bindDragEvent:function(){var t=this,r=t.get("container");r.on(e.Gesture.start,i,t).on("dragstart",t._fixDragStart)},detachDragEvent:function(){var t=this;t.get("container").detach(e.Gesture.start,i,t).detach("dragstart",t._fixDragStart)},_getHandler:function(e){for(var t=this,r=t.get("container"),n=t.get("handlers");e&&e[0]!==r[0];){for(var a=0;a<n.length;a++){var i=n[a];if(e.test(i))return e}e=e.parent()}return null},_getNode:function(e){return e.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(e){return a(e)}},selector:{},handlers:{value:[],getter:0}}});});KISSY.add('kg/dd/2.0.0/lib/droppable-delegate',["node","./ddm","./droppable"],function(S ,require, exports, module) {function e(){var e=this,n=e.get("container"),a=[],r=e.get("selector");n.all(r).each(function(e){t.cacheWH(e),a.push(e)}),e.__allNodes=a}var n=require("node"),t=require("./ddm"),a=require("./droppable");module.exports=a.extend({initializer:function(){t.on("dragstart",e,this)},getNodeFromTarget:function(e,n,a){var r={left:e.pageX,top:e.pageY},l=this,o=l.__allNodes,s=0,i=Number.MAX_VALUE;return o&&S.each(o,function(e){var l=e[0];if(l!==a&&l!==n){var o=t.region(e);if(t.inRegion(o,r)){var d=t.area(o);i>d&&(i=d,s=e)}}}),s&&(l.setInternal("lastNode",l.get("node")),l.setInternal("node",s)),s},_handleOut:function(){var e=this;e.callSuper(),e.setInternal("node",0),e.setInternal("lastNode",0)},_handleOver:function(e){var n=this,t=n.get("node"),a=DroppableDelegate.superclass._handleOut,r=n.callSuper,l=DroppableDelegate.superclass._handleEnter,o=n.get("lastNode");o[0]!==t[0]?(n.setInternal("node",o),a.apply(n,arguments),n.setInternal("node",t),l.call(n,e)):r.call(n,e)},_end:function(e){var n=this;n.callSuper(e),n.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(e){return n.one(e)}}}});});KISSY.add('kg/dd/2.0.0/lib/droppable',["node","./ddm","base"],function(S ,require, exports, module) {function e(e,r){if(r===!0)return 1;for(var t in e)if(r[t])return 1;return 0}var r=require("node"),t=require("./ddm"),o=require("base"),i=t.PREFIX_CLS;module.exports=o.extend({initializer:function(){var e=this;e.addTarget(t),t._regDrop(this)},getNodeFromTarget:function(e,r,t){var o=this.get("node"),i=o[0];return i===r||i===t?null:o},_active:function(){var r=this,o=t.get("activeDrag"),n=r.get("node"),d=r.get("groups"),a=o.get("groups");e(d,a)?(t._addValidDrop(r),n&&(n.addClass(i+"drop-active-valid"),t.cacheWH(n))):n&&n.addClass(i+"drop-active-invalid")},_deActive:function(){var e=this.get("node");e&&e.removeClass(i+"drop-active-valid").removeClass(i+"drop-active-invalid")},__getCustomEvt:function(e){return S.mix({drag:t.get("activeDrag"),drop:this},e)},_handleOut:function(){var e=this,r=e.__getCustomEvt();e.get("node").removeClass(i+"drop-over"),e.fire("dropexit",r)},_handleEnter:function(e){var r=this,t=r.__getCustomEvt(e);t.drag._handleEnter(t),r.get("node").addClass(i+"drop-over"),r.fire("dropenter",t)},_handleOver:function(e){var r=this,t=r.__getCustomEvt(e);t.drag._handleOver(t),r.fire("dropover",t)},_end:function(){var e=this,r=e.__getCustomEvt();e.get("node").removeClass(i+"drop-over"),e.fire("drophit",r)},destructor:function(){t._unRegDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(e){return e?r.one(e):void 0}},groups:{value:{}},disabled:{}}});});